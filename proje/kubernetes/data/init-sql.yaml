apiVersion: v1
kind: ConfigMap
metadata:
  name: postgresql-init-script
data:
  init.sql: |
    CREATE SCHEMA IF NOT EXISTS smartface;
    SET search_path TO smartface;
    CREATE TABLE IF NOT EXISTS keycloak_events (
       ID SERIAL PRIMARY KEY,
       INSER_DATE TIMESTAMP NOT NULL,
       STATUS VARCHAR(20) NOT NULL CHECK (STATUS IN ('NEW', 'PROCESSED', 'FAILED')),
       EVENT_ID VARCHAR(255) UNIQUE NOT NULL,
       EVENT_TYPE  VARCHAR(255) NOT NULL,
       EVENT_JSON VARCHAR(4000) NOT NULL
       );